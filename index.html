<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deriv Demo Trading Bot - Martingale</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Icons
        const TrendingUp = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                <polyline points="17 6 23 6 23 12"></polyline>
            </svg>
        );

        const TrendingDown = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polyline points="23 18 13.5 8.5 8.5 13.5 1 6"></polyline>
                <polyline points="17 18 23 18 23 12"></polyline>
            </svg>
        );

        const Activity = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
            </svg>
        );

        const DollarSign = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <line x1="12" y1="1" x2="12" y2="23"></line>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
            </svg>
        );

        const AlertTriangle = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                <line x1="12" y1="9" x2="12" y2="13"></line>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
        );

        const Play = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
        );

        const Square = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            </svg>
        );

        const Settings = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M12 1v6m0 6v6m5.196-15.804l-4.242 4.242m0 6.364l-4.242 4.242M23 12h-6m-6 0H1m20.804-5.196l-4.242 4.242m-6.364 0l-4.242-4.242M12 1v6m0 6v6"></path>
            </svg>
        );

        const Layers = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polygon points="12 2 2 7 12 12 22 7 12 2"></polygon>
                <polyline points="2 17 12 22 22 17"></polyline>
                <polyline points="2 12 12 17 22 12"></polyline>
            </svg>
        );

        const DerivDemoBot = () => {
            const [connected, setConnected] = useState(false);
            const [running, setRunning] = useState(false);
            const [balance, setBalance] = useState(10000);
            const [trades, setTrades] = useState([]);
            const [stats, setStats] = useState({ wins: 0, losses: 0, profit: 0 });
            const [apiToken, setApiToken] = useState('');
            const [showSettings, setShowSettings] = useState(true);
            const [logs, setLogs] = useState([]);
            const [martingaleStep, setMartingaleStep] = useState(0);
            const [currentStake, setCurrentStake] = useState(10);
            
            const [strategy, setStrategy] = useState({
                type: 'rsi_ma',
                baseStake: 10,
                martingaleEnabled: true,
                martingaleMultiplier: 2,
                maxMartingaleSteps: 5,
                rsiPeriod: 14,
                rsiOversold: 30,
                rsiOverbought: 70,
                maPeriod: 20,
                stopLoss: 500,
                targetProfit: 200,
                maxStake: 1000
            });

            const ws = useRef(null);
            const priceHistory = useRef([]);
            const isRunning = useRef(false);

            const addLog = (message, type = 'info') => {
                setLogs(prev => [...prev.slice(-50), { 
                    time: new Date().toLocaleTimeString(), 
                    message, 
                    type 
                }]);
            };

            const calculateRSI = (prices, period = 14) => {
                if (prices.length < period + 1) return 50;
                
                let gains = 0, losses = 0;
                for (let i = prices.length - period; i < prices.length; i++) {
                    const diff = prices[i] - prices[i - 1];
                    if (diff > 0) gains += diff;
                    else losses += Math.abs(diff);
                }
                
                const avgGain = gains / period;
                const avgLoss = losses / period;
                if (avgLoss === 0) return 100;
                
                const rs = avgGain / avgLoss;
                return 100 - (100 / (1 + rs));
            };

            const calculateSMA = (prices, period = 20) => {
                if (prices.length < period) return prices[prices.length - 1];
                const slice = prices.slice(-period);
                return slice.reduce((a, b) => a + b, 0) / period;
            };

            const analyzeMarket = () => {
                const prices = priceHistory.current;
                if (prices.length < Math.max(strategy.rsiPeriod + 1, strategy.maPeriod)) {
                    return null;
                }

                const rsi = calculateRSI(prices, strategy.rsiPeriod);
                const sma = calculateSMA(prices, strategy.maPeriod);
                const currentPrice = prices[prices.length - 1];

                if (rsi < strategy.rsiOversold && currentPrice < sma) {
                    return { action: 'CALL' };
                }
                
                if (rsi > strategy.rsiOverbought && currentPrice > sma) {
                    return { action: 'PUT' };
                }

                return null;
            };

            const calculateNextStake = (won) => {
                if (won) {
                    // Reset to base stake on win
                    setMartingaleStep(0);
                    const newStake = strategy.baseStake;
                    setCurrentStake(newStake);
                    addLog(`Win! Reset stake to base: $${newStake}`, 'success');
                    return newStake;
                } else {
                    // Increase stake on loss
                    if (!strategy.martingaleEnabled) {
                        return strategy.baseStake;
                    }
                    
                    const nextStep = martingaleStep + 1;
                    
                    if (nextStep >= strategy.maxMartingaleSteps) {
                        addLog(`Max martingale steps reached! Resetting to base stake`, 'error');
                        setMartingaleStep(0);
                        const newStake = strategy.baseStake;
                        setCurrentStake(newStake);
                        return newStake;
                    }
                    
                    setMartingaleStep(nextStep);
                    const newStake = Math.min(
                        strategy.baseStake * Math.pow(strategy.martingaleMultiplier, nextStep),
                        strategy.maxStake
                    );
                    setCurrentStake(newStake);
                    addLog(`Loss! Martingale step ${nextStep}: Stake increased to $${newStake.toFixed(2)}`, 'error');
                    return newStake;
                }
            };

            const connect = () => {
                if (!apiToken) {
                    addLog('Please enter your Deriv demo API token', 'error');
                    return;
                }

                ws.current = new WebSocket('wss://ws.derivws.com/websockets/v3?app_id=1089');
                
                ws.current.onopen = () => {
                    addLog('Connected to Deriv API', 'success');
                    ws.current.send(JSON.stringify({ authorize: apiToken }));
                };

                ws.current.onmessage = (msg) => {
                    const data = JSON.parse(msg.data);
                    
                    if (data.authorize) {
                        setConnected(true);
                        setBalance(data.authorize.balance);
                        addLog(`Authorized. Balance: ${data.authorize.balance}`, 'success');
                        ws.current.send(JSON.stringify({ 
                            ticks: 'R_75',
                            subscribe: 1
                        }));
                    }

                    if (data.tick) {
                        const price = parseFloat(data.tick.quote);
                        priceHistory.current.push(price);
                        if (priceHistory.current.length > 100) {
                            priceHistory.current.shift();
                        }

                        if (isRunning.current && priceHistory.current.length >= 30) {
                            checkForTrade();
                        }
                    }

                    // Handle proposal response (contract price quote)
                    if (data.proposal) {
                        const proposalId = data.proposal.id;
                        const askPrice = data.proposal.ask_price;
                        
                        addLog(`Proposal received - Ask price: ${askPrice}`, 'info');
                        
                        // Buy the contract
                        const buyRequest = {
                            buy: proposalId,
                            price: askPrice
                        };
                        
                        addLog(`Buying contract...`, 'info');
                        ws.current.send(JSON.stringify(buyRequest));
                    }

                    // Handle buy response (contract purchased)
                    if (data.buy) {
                        const contractId = data.buy.contract_id;
                        const buyPrice = data.buy.buy_price;
                        
                        addLog(`Contract purchased! ID: ${contractId}, Price: ${buyPrice}`, 'success');
                        
                        // Update balance
                        setBalance(data.buy.balance_after);
                        
                        // Subscribe to contract updates to know when it settles
                        ws.current.send(JSON.stringify({
                            proposal_open_contract: 1,
                            contract_id: contractId,
                            subscribe: 1
                        }));
                    }

                    // Handle contract result updates
                    if (data.proposal_open_contract) {
                        const contract = data.proposal_open_contract;
                        
                        // Only process if contract is sold/closed
                        if (contract.status === 'sold' || contract.is_sold) {
                            const profit = parseFloat(contract.profit);
                            const win = profit > 0;
                            
                            addLog(
                                `Contract closed - ${win ? 'WON' : 'LOST'}: ${profit >= 0 ? '+' : ''}${profit.toFixed(2)}`,
                                win ? 'success' : 'error'
                            );
                            
                            // Update balance
                            setBalance(parseFloat(contract.balance_after || contract.account_balance));
                            
                            // Update stats
                            setStats(prev => ({
                                wins: prev.wins + (win ? 1 : 0),
                                losses: prev.losses + (win ? 0 : 1),
                                profit: prev.profit + profit
                            }));

                            // Update trade in history
                            setTrades(prev => prev.map(t => {
                                if (t.status === 'pending' && !t.processed) {
                                    return { ...t, status: win ? 'win' : 'loss', payout: profit, processed: true };
                                }
                                return t;
                            }));

                            // Calculate next stake based on result
                            calculateNextStake(win);
                        } else {
                            // Contract still open
                            addLog(`Contract in progress - Current P&L: ${contract.profit?.toFixed(2) || '0.00'}`, 'info');
                        }
                    }

                    if (data.error) {
                        addLog(`Error: ${data.error.message}`, 'error');
                        
                        // If there's an error, reset the trade as failed
                        setTrades(prev => prev.map(t => {
                            if (t.status === 'pending' && !t.processed) {
                                return { ...t, status: 'error', payout: 0, processed: true };
                            }
                            return t;
                        }));
                    }
                };

                ws.current.onerror = (error) => {
                    addLog('Connection error', 'error');
                    setConnected(false);
                };

                ws.current.onclose = () => {
                    addLog('Disconnected from Deriv', 'error');
                    setConnected(false);
                    setRunning(false);
                    isRunning.current = false;
                };
            };

            const checkForTrade = () => {
                const signal = analyzeMarket();
                
                if (signal && balance >= currentStake) {
                    if (stats.profit <= -strategy.stopLoss) {
                        addLog(`Stop loss hit: ${stats.profit.toFixed(2)}`, 'error');
                        stopBot();
                        return;
                    }
                    
                    if (stats.profit >= strategy.targetProfit) {
                        addLog(`Target profit reached: ${stats.profit.toFixed(2)}`, 'success');
                        stopBot();
                        return;
                    }

                    if (currentStake > balance) {
                        addLog(`Insufficient balance for stake ${currentStake.toFixed(2)}`, 'error');
                        stopBot();
                        return;
                    }

                    // Check if we already have a pending trade
                    const hasPendingTrade = trades.some(t => t.status === 'pending' && !t.processed);
                    if (hasPendingTrade) {
                        return; // Don't open new trade while one is pending
                    }

                    executeTrade(signal.action);
                }
            };

            const executeTrade = (direction) => {
                const contractType = direction === 'CALL' ? 'CALL' : 'PUT';
                
                const trade = {
                    id: Date.now(),
                    type: contractType,
                    stake: currentStake,
                    martingaleStep: martingaleStep,
                    time: new Date().toLocaleTimeString(),
                    status: 'pending'
                };

                addLog(`Opening ${contractType} position - Stake: ${currentStake.toFixed(2)} (Step: ${martingaleStep})`, 'info');
                setTrades(prev => [trade, ...prev.slice(0, 19)]);

                // Step 1: Get contract proposal (price quote)
                const proposalRequest = {
                    proposal: 1,
                    amount: currentStake,
                    basis: 'stake',
                    contract_type: contractType,
                    currency: 'USD',
                    duration: 5,
                    duration_unit: 't', // ticks
                    symbol: 'R_75'
                };

                addLog(`Requesting contract proposal for ${contractType}...`, 'info');
                ws.current.send(JSON.stringify(proposalRequest));

                // Store trade info for when we get the proposal response
                trade.pendingProposal = true;
                
                // We'll handle the actual buy in the onmessage handler
                // Store current trade in a ref so we can access it
                window.currentPendingTrade = trade;
            };

            const startBot = () => {
                if (!connected) {
                    addLog('Please connect to Deriv first', 'error');
                    return;
                }
                
                // Reset martingale on start
                setMartingaleStep(0);
                setCurrentStake(strategy.baseStake);
                
                setRunning(true);
                isRunning.current = true;
                addLog('Bot started - Monitoring market...', 'success');
                if (strategy.martingaleEnabled) {
                    addLog(`Martingale enabled: ${strategy.martingaleMultiplier}x multiplier, max ${strategy.maxMartingaleSteps} steps`, 'info');
                }
            };

            const stopBot = () => {
                setRunning(false);
                isRunning.current = false;
                setMartingaleStep(0);
                setCurrentStake(strategy.baseStake);
                addLog('Bot stopped', 'info');
            };

            const winRate = stats.wins + stats.losses > 0 
                ? ((stats.wins / (stats.wins + stats.losses)) * 100).toFixed(1)
                : 0;

            const maxPossibleLoss = strategy.baseStake * 
                (Math.pow(strategy.martingaleMultiplier, strategy.maxMartingaleSteps + 1) - 1) / 
                (strategy.martingaleMultiplier - 1);

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white p-4">
                    <div className="max-w-7xl mx-auto">
                        <div className="mb-6">
                            <h1 className="text-3xl font-bold mb-2 flex items-center gap-2">
                                <Layers size={32} className="text-red-400" />
                                Deriv Demo Bot - Martingale Strategy
                            </h1>
                            <p className="text-slate-400">RSI + Moving Average with Martingale | HIGH RISK Strategy</p>
                        </div>

                        {/* EXTREME WARNING */}
                        <div className="bg-red-900/40 border-2 border-red-500 rounded-lg p-4 mb-6">
                            <div className="flex gap-3">
                                <AlertTriangle className="text-red-400 flex-shrink-0" size={24} />
                                <div className="text-sm">
                                    <p className="font-bold text-red-400 mb-2 text-lg">⚠️ EXTREME RISK WARNING ⚠️</p>
                                    <p className="text-white mb-2">Martingale strategy can WIPE OUT your entire balance in seconds!</p>
                                    <ul className="list-disc list-inside space-y-1 text-slate-200">
                                        <li>A losing streak of {strategy.maxMartingaleSteps} trades = ${maxPossibleLoss.toFixed(2)} loss</li>
                                        <li>Win rate needs to be very high to overcome exponential losses</li>
                                        <li>One bad streak can erase days/weeks of profits</li>
                                        <li>NEVER use this with real money without extensive testing</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        {showSettings && (
                            <div className="bg-slate-800 rounded-lg p-6 mb-6 border border-slate-700">
                                <h2 className="text-xl font-semibold mb-4 flex items-center gap-2">
                                    <Settings size={20} />
                                    Configuration
                                </h2>
                                
                                <div className="space-y-6">
                                    {/* API Token */}
                                    <div>
                                        <label className="block text-sm text-slate-300 mb-2">
                                            Deriv Demo API Token
                                        </label>
                                        <input
                                            type="password"
                                            value={apiToken}
                                            onChange={(e) => setApiToken(e.target.value)}
                                            placeholder="Get from Deriv > Manage API tokens"
                                            className="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white"
                                        />
                                        <p className="text-xs text-slate-400 mt-1">
                                            Create a demo token at: app.deriv.com → Settings → API Token
                                        </p>
                                    </div>

                                    {/* Martingale Settings */}
                                    <div className="border-t border-slate-600 pt-4">
                                        <h3 className="font-semibold mb-3 flex items-center gap-2">
                                            <Layers size={18} className="text-red-400" />
                                            Martingale Settings
                                        </h3>
                                        
                                        <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
                                            <div>
                                                <label className="block text-sm text-slate-300 mb-2">Base Stake ($)</label>
                                                <input
                                                    type="number"
                                                    value={strategy.baseStake}
                                                    onChange={(e) => {
                                                        const val = parseFloat(e.target.value);
                                                        setStrategy(prev => ({ ...prev, baseStake: val }));
                                                        setCurrentStake(val);
                                                    }}
                                                    className="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2"
                                                    step="0.1"
                                                />
                                            </div>

                                            <div>
                                                <label className="block text-sm text-slate-300 mb-2">Multiplier</label>
                                                <select
                                                    value={strategy.martingaleMultiplier}
                                                    onChange={(e) => setStrategy(prev => ({ 
                                                        ...prev, 
                                                        martingaleMultiplier: parseFloat(e.target.value) 
                                                    }))}
                                                    className="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2"
                                                >
                                                    <option value="1.2">1.2x</option>
                                                    <option value="1.5">1.5x</option>
                                                    <option value="2">2x</option>
                                                    <option value="2.5">2.5x</option>
                                                    <option value="3">3x</option>
                                                </select>
                                            </div>

                                            <div>
                                                <label className="block text-sm text-slate-300 mb-2">Custom Multiplier</label>
                                                <input
                                                    type="number"
                                                    value={strategy.martingaleMultiplier}
                                                    onChange={(e) => setStrategy(prev => ({ 
                                                        ...prev, 
                                                        martingaleMultiplier: parseFloat(e.target.value) 
                                                    }))}
                                                    className="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2"
                                                    step="0.1"
                                                    min="1.1"
                                                    max="5"
                                                />
                                            </div>

                                            <div>
                                                <label className="block text-sm text-slate-300 mb-2">Max Steps</label>
                                                <input
                                                    type="number"
                                                    value={strategy.maxMartingaleSteps}
                                                    onChange={(e) => setStrategy(prev => ({ 
                                                        ...prev, 
                                                        maxMartingaleSteps: parseInt(e.target.value) 
                                                    }))}
                                                    className="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2"
                                                    min="1"
                                                    max="10"
                                                />
                                            </div>

                                            <div>
                                                <label className="block text-sm text-slate-300 mb-2">Max Stake ($)</label>
                                                <input
                                                    type="number"
                                                    value={strategy.maxStake}
                                                    onChange={(e) => setStrategy(prev => ({ 
                                                        ...prev, 
                                                        maxStake: parseFloat(e.target.value) 
                                                    }))}
                                                    className="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2"
                                                />
                                            </div>

                                            <div>
                                                <label className="block text-sm text-slate-300 mb-2">Stop Loss ($)</label>
                                                <input
                                                    type="number"
                                                    value={strategy.stopLoss}
                                                    onChange={(e) => setStrategy(prev => ({ 
                                                        ...prev, 
                                                        stopLoss: parseFloat(e.target.value) 
                                                    }))}
                                                    className="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2"
                                                />
                                            </div>

                                            <div>
                                                <label className="block text-sm text-slate-300 mb-2">Target Profit ($)</label>
                                                <input
                                                    type="number"
                                                    value={strategy.targetProfit}
                                                    onChange={(e) => setStrategy(prev => ({ 
                                                        ...prev, 
                                                        targetProfit: parseFloat(e.target.value) 
                                                    }))}
                                                    className="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2"
                                                />
                                            </div>

                                            <div className="flex items-end">
                                                <label className="flex items-center gap-2 cursor-pointer">
                                                    <input
                                                        type="checkbox"
                                                        checked={strategy.martingaleEnabled}
                                                        onChange={(e) => setStrategy(prev => ({ 
                                                            ...prev, 
                                                            martingaleEnabled: e.target.checked 
                                                        }))}
                                                        className="w-5 h-5"
                                                    />
                                                    <span className="text-sm">Enable Martingale</span>
                                                </label>
                                            </div>
                                        </div>

                                        {/* Martingale Preview */}
                                        <div className="mt-4 p-3 bg-slate-700 rounded">
                                            <p className="text-xs text-slate-300 mb-2">Stake Progression Preview:</p>
                                            <div className="flex flex-wrap gap-2 text-xs">
                                                {Array.from({ length: strategy.maxMartingaleSteps + 1 }, (_, i) => {
                                                    const stake = Math.min(
                                                        strategy.baseStake * Math.pow(strategy.martingaleMultiplier, i),
                                                        strategy.maxStake
                                                    );
                                                    return (
                                                        <span key={i} className={`px-2 py-1 rounded ${
                                                            i === 0 ? 'bg-green-600' : 
                                                            i <= 2 ? 'bg-yellow-600' : 'bg-red-600'
                                                        }`}>
                                                            Step {i}: ${stake.toFixed(2)}
                                                        </span>
                                                    );
                                                })}
                                            </div>
                                            <p className="text-xs text-red-400 mt-2">
                                                Max possible loss in one streak: ${maxPossibleLoss.toFixed(2)}
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                <div className="flex gap-3 mt-6">
                                    {!connected ? (
                                        <button
                                            onClick={connect}
                                            className="bg-blue-600 hover:bg-blue-700 px-6 py-2 rounded font-semibold"
                                        >
                                            Connect to Deriv
                                        </button>
                                    ) : (
                                        <button
                                            onClick={() => setShowSettings(false)}
                                            className="bg-green-600 hover:bg-green-700 px-6 py-2 rounded font-semibold"
                                        >
                                            Hide Settings
                                        </button>
                                    )}
                                </div>
                            </div>
                        )}

                        {/* Stats Dashboard */}
                        <div className="grid md:grid-cols-5 gap-4 mb-6">
                            <div className="bg-slate-800 rounded-lg p-4 border border-slate-700">
                                <div className="flex items-center justify-between mb-2">
                                    <span className="text-slate-400 text-sm">Balance</span>
                                    <DollarSign size={18} className="text-green-400" />
                                </div>
                                <div className="text-2xl font-bold">${balance.toFixed(2)}</div>
                            </div>

                            <div className="bg-slate-800 rounded-lg p-4 border border-slate-700">
                                <div className="flex items-center justify-between mb-2">
                                    <span className="text-slate-400 text-sm">Profit/Loss</span>
                                    {stats.profit >= 0 ? <TrendingUp size={18} className="text-green-400" /> : <TrendingDown size={18} className="text-red-400" />}
                                </div>
                                <div className={`text-2xl font-bold ${stats.profit >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                                    {stats.profit >= 0 ? '+' : ''}${stats.profit.toFixed(2)}
                                </div>
                            </div>

                            <div className="bg-slate-800 rounded-lg p-4 border border-slate-700">
                                <div className="flex items-center justify-between mb-2">
                                    <span className="text-slate-400 text-sm">Current Stake</span>
                                    <Layers size={18} className="text-yellow-400" />
                                </div>
                                <div className="text-2xl font-bold">${currentStake.toFixed(2)}</div>
                                <div className="text-xs text-slate-400">Step: {martingaleStep}</div>
                            </div>

                            <div className="bg-slate-800 rounded-lg p-4 border border-slate-700">
                                <div className="flex items-center justify-between mb-2">
                                    <span className="text-slate-400 text-sm">Win Rate</span>
                                    <Activity size={18} className="text-blue-400" />
                                </div>
                                <div className="text-2xl font-bold">{winRate}%</div>
                                <div className="text-xs text-slate-400">{stats.wins}W / {stats.losses}L</div>
                            </div>

                            <div className="bg-slate-800 rounded-lg p-4 border border-slate-700">
                                <div className="flex items-center justify-between mb-2">
                                    <span className="text-slate-400 text-sm">Status</span>
                                    <div className={`w-3 h-3 rounded-full ${connected ? 'bg-green-400' : 'bg-red-400'}`} />
                                </div>
                                <div className="text-lg font-bold">{running ? 'Running' : 'Stopped'}</div>
                            </div>
                        </div>

                        {/* Controls */}
                        {connected && (
                            <div className="bg-slate-800 rounded-lg p-4 mb-6 border border-slate-700 flex gap-3">
                                {!running ? (
                                    <button
                                        onClick={startBot}
                                        className="flex items-center gap-2 bg-green-600 hover:bg-green-700 px-6 py-3 rounded font-semibold"
                                    >
                                        <Play size={18} />
                                        Start Bot
                                    </button>
                                ) : (
                                    <button
                                        onClick={stopBot}
                                        className="flex items-center gap-2 bg-red-600 hover:bg-red-700 px-6 py-3 rounded font-semibold"
                                    >
                                        <Square size={18} />
                                        Stop Bot
                                    </button>
                                )}
                                <button
                                    onClick={() => setShowSettings(!showSettings)}
                                    className="flex items-center gap-2 bg-slate-700 hover:bg-slate-600 px-6 py-3 rounded"
                                >
                                    <Settings size={18} />
                                    Settings
                                </button>
                            </div>
                        )}

                        {/* Trade History & Logs */}
                        <div className="grid md:grid-cols-2 gap-6">
                            <div className="bg-slate-800 rounded-lg p-4 border border-slate-700">
                                <h3 className="font-semibold mb-3">Recent Trades</h3>
                                <div className="space-y-2 max-h-96 overflow-y-auto">
                                    {trades.length === 0 ? (
                                        <p className="text-slate-400 text-sm">No trades yet</p>
                                    ) : (
                                        trades.map(trade => (
                                            <div key={trade.id} className="bg-slate-700 rounded p-3">
                                                <div className="flex justify-between items-start">
                                                    <div>
                                                        <div className="font-semibold flex items-center gap-2">
                                                            {trade.type}
                                                            {trade.martingaleStep > 0 && (
                                                                <span className="text-xs bg-red-600 px-2 py-0.5 rounded">
                                                                    Step {trade.martingaleStep}
                                                                </span>
                                                            )}
                                                        </div>
                                                        <div className="text-xs text-slate-400">{trade.time}</div>
                                                    </div>
                                                    <div className="text-right">
                                                        <div className="text-sm text-slate-400">Stake: ${trade.stake.toFixed(2)}</div>
                                                        {trade.status !== 'pending' && (
                                                            <div className={`font-semibold ${trade.payout >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                                                                {trade.payout >= 0 ? '+' : ''}${trade.payout?.toFixed(2)}
                                                            </div>
                                                        )}
                                                        {trade.status === 'pending' && (
                                                            <div className="text-yellow-400 text-sm">Pending...</div>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>
                                        ))
                                    )}
                                </div>
                            </div>

                            <div className="bg-slate-800 rounded-lg p-4 border border-slate-700">
                                <h3 className="font-semibold mb-3">Activity Log</h3>
                                <div className="space-y-1 max-h-96 overflow-y-auto font-mono text-xs">
                                    {logs.length === 0 ? (
                                        <p className="text-slate-400">No activity yet</p>
                                    ) : (
                                        logs.map((log, i) => (
                                            <div key={i} className={`${
                                                log.type === 'error' ? 'text-red-400' :
                                                log.type === 'success' ? 'text-green-400' :
                                                'text-slate-300'
                                            }`}>
                                                [{log.time}] {log.message}
                                            </div>
                                        ))
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<DerivDemoBot />, document.getElementById('root'));
    </script>
</body>
</html>
